# Weather App

Это приложение на основе FastAPI для получения информации о погоде. Приложение интегрируется с внешним API для получения данных о погоде.

## Настройка проекта

### 1. Клонирование репозитория:

```bash
git clone https://github.com/IrinaIvI/Weather-app.git
cd Weather-app
```

### 2. Настройка окружения:

```bash
poetry config virtualenvs.in-project true
poetry shell
poetry install
```

### 3.  Запуск сервера:

```bash
python src/app/main.py
```

# Методы для работы с погодой и городами

## `fetch_weather_data`

Этот метод запрашивает данные о текущей погоде по заданным координатам (широте и долготе) с помощью API **Open-Meteo**. Он возвращает данные в формате JSON, содержащие информацию о температуре, скорости ветра и атмосферном давлении на момент запроса.

### Параметры:
- `latitude` (float): Широта города.
- `longitude` (float): Долгота города.

### Возвращаемое значение:
- Словарь с данными о текущей погоде.

---

## `delete_old_weather_report`

Этот метод удаляет старые записи о погоде из базы данных, которые были обновлены более 24 часов назад. Планируется выполнять эту задачу ежедневно в полночь с использованием планировщика.

### Параметры:
- Нет.

### Возвращаемое значение:
- Нет.

---

## `api_get_actual_weather`

Этот метод получает актуальные данные о погоде для указанного города (по его координатам).

### Параметры:
`request_body` (ActualWeatherSchemeRequest): Данные о городе и времени для получения актуальной информации о погоде.`request_body` (RBCityWeather): Данные о городе для получения актуальной информации о погоде.

### Возвращаемое значение:
- Объект типа `ActualWeatherSchemeResponse`, содержащий:
  - Температура
  - Скорость ветра
  - Атмосферное давление

---

## `update_weather_params`

Этот метод обновляет данные о погоде для указанного города в базе данных, запрашивая актуальные данные с API **Open-Meteo**.

### Параметры:
- `city_name` (str): Название города.
- `latitude` (float): Широта города.
- `longitude` (float): Долгота города.

### Возвращаемое значение:
- Нет.

---

## `api_add_city`

Этот метод добавляет новый город в базу данных и сохраняет его текущие погодные условия. Также создается задача в планировщике для регулярного обновления данных о погоде каждые 15 минут.

### Параметры:
- `request_body` (CitySchemeRequest): Данные о городе для получения актуальной информации о погоде.
- `db` (AsyncSession): Сессия базы данных.

### Возвращаемое значение:
- Ответ в формате JSON об успешном добавлении города в список доступных городов.

---

## `api_get_cities`

Этот метод получает список всех городов пользователя из базы данных.

### Параметры:
- `user_id` (int): Идентификатор пользователя.
- `db` (AsyncSession): Сессия базы данных.

### Возвращаемое значение:
- Список объектов типа `CitySchemeResponse`, содержащих:
  - Идентификатор города
  - Название города
  - Широту и долготу города

---

## `api_get_city`

Этот метод получает данные о погоде для указанного города пользователя, включая температуру, влажность, скорость ветра и осадки.

### Параметры:
- `db` (AsyncSession): Сессия базы данных.
- `user_id` (int): Идентификатор пользователя.
- `request_body` (RBCityWeather): Данные о городе и времени для получения актуальной информации о погоде.

### Возвращаемое значение:
- Объект типа `CityWeatherSchemeResponse`, содержащий:
  - Название города
  - Температура
  - Влажность
  - Скорость ветра
  - Осадки

---

## `api_registration`

Этот метод регистрирует нового пользователя в системе.

### Параметры:
- `request_body` (UserSchemeRequest): Данные о пользователе (его имя).
- `db` (AsyncSession): Сессия базы данных.

### Возвращаемое значение:
- Объект типа `UserSchemeResponse`, содержащий идентификатор нового пользователя.

---

## `exist_user`

Этот метод проверяет, существует ли пользователь с указанным идентификатором в базе данных.

### Параметры:
- `user_id` (int): Идентификатор пользователя.
- `db` (AsyncSession): Сессия базы данных.

### Возвращаемое значение:
- Объект типа `User`, если пользователь найден.

## Ожидания от клиента

В текущей версии приложения предполагается, что клиент будет вводить корректные данные о городах, включая правильные координаты (широту и долготу). 
В будущем можно интегрировать **Google Maps API** (или аналогичные сервисы) для проверки введенных координат и автоматического исправления ошибок. Это позволит удостовериться в правильности данных о городах и улучшить точность обработки информации о погоде.
